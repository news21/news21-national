{% extends "story/base.html" %}

{% load i18n %}
{% load smart_if %}
{% load uni_form_tags %}

{% block content %}
<form action="{{ form_url }}" class="uniForm" method="post">
	<div class="grid_10">
	<div class="genericForm contentheader">	
		<h4>Package Information</h4>
		{% with form.helper as helper %}
		    {% uni_form form helper %}
		{% endwith %}
		<p>
			<label>Inherited Tags:</label>
			<span class="inputDiv" id="inherited_tags"></span>
		</p>
		<div class="clear"></div>
		<p>
			<label>Tags:</label>
			<span class="inputDiv">
			{% for tag in tags %}
				<input type="checkbox" name="tag_{{tag.id}}" value="{{tag}}" id="tag_{{tag.id}}" {% for used_tag in used_tags %} {% if tag == used_tag %} checked="true" {% endif %} {% endfor %}  /> {{tag}}
				{% if forloop.counter|divisibleby:4 %}<br/>{% endif %}
			{% endfor %}
			</span>
		</p>
		<div class="clear"></div>
		<div class="inputSubmit">
			<input type="submit" value="Continue &rarr;">
		</div>
		
		
		<div class="clear"></div>
		<br/>
		
		<h4>Package Geotags</h4>
		<div id="map" class="smallmap"></div>
	</div>
	</div>
	<div class="grid_6 genericForm">
		{% if metastory_id %}
			<h4>Package Stories <a href="{% url story_new metastory_id %}">[+]</a></h4>
			{% for story in stories %}
			<div class="sidebar-right-listing alternating-row-{% if forloop.counter|divisibleby:2 %}even{% else %}odd{% endif %}">
				{% for photo in story_photos %}
					{% if photo.id == story.primary_image %}
					<a class="zoom" rel="group" title="{{ photo.title }}" href="{{ photo.get_original_url }}"><img src="{{ photo.get_tiny_thumbnail_url }}" style="vertical-align:middle" class="outline" /></a>
					{% endif %}
				{% endfor %}
				{% if primary_image.id == story.primary_image %}
				<a class="zoom" rel="group" title="{{ primary_image.title }}" href="{{ primary_image.get_original_url }}"><img src="{{ primary_image.get_tiny_thumbnail_url }}" style="vertical-align:middle" class="outline" /></a>
				{% endif %}
				<a href="{% url story_edit metastory_id story.id %}" style="vertical-align:middle">{{ story }} </a><!-- <span>[clone]</span> -->
			</div>
			{% endfor %}
			{% if stories.count == 0 %}
				<div>You have not created any stories yet. <br/>Why not <a href="{% url story_new metastory_id %}">create one?</a></div>
			{% endif %}
		{% else %}
			<h4>Package Stories</h4>
			<div>You have not created any stories yet.</div>
		{% endif %}
		
		<div class="clear"></div>
		<br/>
		<br/>
		<h4>Package Primary Image</h4>
		
		{% if primary_image %}
		<div class="sidebar-right-listing image-selector alternating-row-selected">
			<div class="image-selector-radio"><input type="radio" name="primary_image" id="id_primary_image" checked value="{{ primary_image.id }}"></div>
			<div class="image-selector-thumb"><a class="zoom" rel="group" title="{{ primary_image.title }}" href="{{ primary_image.get_original_url }}"><img src="{{ primary_image.get_thumbnail_url }}" class="outline" /></a></div>
			<div class="image-selector-info">
				<span class="bold">Title:</span> {{ primary_image.title }}
				<br/>
				<span class="bold">Width & Height:</span> {{ primary_image.get_width }} x {{ primary_image.get_height }}
				<br/>
				<span class="bold">Caption:</span> {{ primary_image.summary }}
			</div>
			<div class="clear"></div>
		</div>
		{% endif %}
		{% for photo in story_photos %}
			{% if photo.id != primary_image.id %}
			<div class="sidebar-right-listing image-selector alternating-row-{% if forloop.counter|divisibleby:2 %}even{% else %}odd{% endif %}">
				<div class="image-selector-radio"><input type="radio" name="primary_image" id="id_primary_image" value="{{ photo.id }}"></div>
				<div class="image-selector-thumb"><a class="zoom" rel="group" title="{{ photo.title }}" href="{{ photo.get_original_url }}"><img src="{{ photo.get_thumbnail_url }}" class="outline" /></a></div>
				<div class="image-selector-info">
					<span class="bold">Title:</span> {{ photo.title }}
					<br/>
					<span class="bold">Width & Height:</span> {{ photo.get_width }} x {{ photo.get_height }}
					<br/>
					<span class="bold">Caption:</span> {{ photo.summary }}
				</div>
				<div class="clear"></div>
			</div>
			{% endif %}
		{% endfor %}
		
	</div>
</form>
	
	<div class="clear"></div>
	<br/>
	<br/>
	
	<div class="grid_16 genericForm contentheader">
	<h4>Package Code Repositories</h4>
	{% for repo in repos %}
		<div style="padding:10px;">
			<strong>{{repo.title}}</strong> <br/> 
			&nbsp;&nbsp;&nbsp;{{repo.description}} <br/>
			&nbsp;&nbsp;&nbsp;URL: {{repo.code_url}}
		</div>
	{% endfor %}
	{% if repos.count == 0 %}
		<div>You have not created any code repositories yet.</div>
	{% endif %}
	</div>
	
	<div class="clear"></div>
{% endblock %}



{% block extra_styles %}
<link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}templates/n21alpha/css/google.css" />
<link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}templates/n21alpha/css/openlayers.css" />
<link rel="stylesheet" href="{{ MEDIA_URL }}uni_form/uni-form-generic.css" type="text/css" />
<link rel="stylesheet" href="{{ MEDIA_URL }}uni_form/uni-form.css" type="text/css" />
{% endblock %}

{% block extra_scripts %}
<script src='http://maps.google.com/maps?file=api&amp;v=2&amp;key={{ google_maps_api_key }}'></script>
<script src="http://www.openlayers.org/api/OpenLayers.js"></script>

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.2.6/jquery.js"></script>
<script type="text/javascript" src="{{ MEDIA_URL }}uni_form/uni-form.jquery.js"></script>
<script type="text/javascript" src="{{ MEDIA_URL }}ajax_validation/jquery-ajax-validation.js"></script>
<script type="text/javascript" src="{{ MEDIA_URL }}ajax_validation/jquery-uni-form.js"></script>
{% endblock %}


{% block inline_scripts %}
	$(function() {
		var csoption;
		
		$("#id_newsrooms").click(function() {
			adjustTags();
			
			return true;
		});
		
		{% if not metastory_id %}
		jQuery('#id_headline').slugify('#id_slug');
		{% endif %}
		
		function adjustTags() {
			$("#id_newsrooms option").each(function(){  
				csoption = $(this).val();  
				$(".inputDiv :checkbox").each(function(){  
					$("#inherited_tags").html('');
					if( $(this).attr("id") == "tag_"+csoption ){
						$(this).attr('checked', false);
					}
				});
			});
			
			$("#id_newsrooms option:selected").each(function(){  
				csoption = $(this).val();  
				$(".inputDiv :checkbox").each(function(){  
					if( $(this).attr("id") == "tag_"+csoption ){
						$('#inherited_tags').html($('#inherited_tags').html() + '<span class="tag">' +$(this).val()+ '</span>');
						$(this).attr('checked', true);
					}
				});
			});
		};
		/*
		$("a.zoom").fancybox({
			'overlayOpacity'	:	0.7,
			'overlayColor'		:	'#FFF',
			'zoomSpeedIn'		:	500,
			'zoomSpeedOut'		:	500,
			'overlayShow'		:	false
		});
		*/
		adjustTags();
	});
	
	
	
	var map;
    function init() {
        map = new OpenLayers.Map('map');
        map.addControl(new OpenLayers.Control.LayerSwitcher());
        var gphy = new OpenLayers.Layer.Google(
            "Google Physical",
            {type: G_PHYSICAL_MAP}
        );
        var gmap = new OpenLayers.Layer.Google(
            "Google Streets", // the default
            {numZoomLevels: 20}
        );
        var ghyb = new OpenLayers.Layer.Google(
            "Google Hybrid",
            {type: G_HYBRID_MAP, numZoomLevels: 20}
        );
        var gsat = new OpenLayers.Layer.Google(
            "Google Satellite",
            {type: G_SATELLITE_MAP, numZoomLevels: 22}
        );
        map.addLayers([gmap, ghyb, gphy, gsat]);
        map.setCenter(new OpenLayers.LonLat(10.2, 48.9), 5);
    }
	
	init();
{% endblock %}

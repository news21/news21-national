{% extends "story/base.html" %}


{% load i18n %}
{% load smart_if %}


{% block content %}
	<div class="grid_10 genericForm">
		<form action="{{ form_url }}" method="post">
		<h4>Package Info</h4>
		{{ form.as_p }}
		<p>
			<label>Inherited Tags:</label>
			<span class="inputDiv" id="inherited_tags"></span>
		</p>
		<div class="clear"></div>
		<p>
			<label>Tags:</label>
			<span class="inputDiv">
			{% for tag in tags %}
				<input type="checkbox" name="tag_{{tag.id}}" value="{{tag}}" id="tag_{{tag.id}}" {% for used_tag in used_tags %} {% if tag.id == used_tag.id %} checked {% endif %} {% endfor %}  /> {{tag}}
				{% if forloop.counter|divisibleby:4 %}<br/>{% endif %}
			{% endfor %}
			</span>
		</p>
		<div class="clear"></div>
		<div class="inputSubmit">
			<input type="submit" value="Continue &rarr;">
		</div>
	</div>
	<div class="grid_6">
		{% if metastory_id %}
			<h4>Package Stories <a href="{% url story_new metastory_id %}">[+]</a></h4>
			{% for story in stories %}
			<div class="sidebar-right-listing alternating-row-{% if forloop.counter|divisibleby:2 %}even{% else %}odd{% endif %}">
				{% for photo in story_photos %}
					{% if photo.id == story.primary_image %}
					<a class="zoom" rel="group" title="{{ photo.title }}" href="{{ photo.get_original_url }}"><img src="{{ photo.get_tiny_thumbnail_url }}" class="outline" /></a>
					{% endif %}
				{% endfor %}
				<a href="{% url story_edit metastory_id story.id %}">{{ story }}</a> <span>[clone]</span>
			</div>
			{% endfor %}
			{% if stories.count == 0 %}
				<div>You have not created any stories yet. <br/>Why not <a href="{% url story_new metastory_id %}">create one?</a></div>
			{% endif %}
		{% else %}
			<h4>Package Stories</h4>
			<div>You have not created any stories yet.</div>
		{% endif %}
		
		<div class="clear"></div>
		<br/>
		<br/>
		<h4>Package Primary Image</h4>
		
		{% if primary_image %}
		<div class="sidebar-right-listing image-selector alternating-row-selected">
			<div class="image-selector-radio"><input type="radio" name="primary_image" id="id_primary_image" checked value="{{ primary_image.id }}"></div>
			<div class="image-selector-thumb"><a class="zoom" rel="group" title="{{ primary_image.title }}" href="{{ primary_image.get_original_url }}"><img src="{{ primary_image.get_thumbnail_url }}" class="outline" /></a></div>
			<div class="image-selector-info">
				<span class="bold">Title:</span> {{ primary_image.title }}
				<br/>
				<span class="bold">Width & Height:</span> {{ primary_image.get_width }} x {{ primary_image.get_height }}
				<br/>
				<span class="bold">Caption:</span> {{ primary_image.summary }}
			</div>
			<div class="clear"></div>
		</div>
		{% endif %}
		{% for photo in story_photos %}
			{% if photo.id != primary_image.id %}
			<div class="sidebar-right-listing image-selector alternating-row-{% if forloop.counter|divisibleby:2 %}even{% else %}odd{% endif %}">
				<div class="image-selector-radio"><input type="radio" name="primary_image" id="id_primary_image" value="{{ photo.id }}"></div>
				<div class="image-selector-thumb"><a class="zoom" rel="group" title="{{ photo.title }}" href="{{ photo.get_original_url }}"><img src="{{ photo.get_thumbnail_url }}" class="outline" /></a></div>
				<div class="image-selector-info">
					<span class="bold">Title:</span> {{ photo.title }}
					<br/>
					<span class="bold">Width & Height:</span> {{ photo.get_width }} x {{ photo.get_height }}
					<br/>
					<span class="bold">Caption:</span> {{ photo.summary }}
				</div>
				<div class="clear"></div>
			</div>
			{% endif %}
		{% endfor %}
		</form>
	</div>
	
	<div class="clear"></div>
{% endblock %}


{% block inline_scripts %}
	$(function() {
		var csoption;
		
		$("#id_newsrooms").click(function() {
			adjustTags();
			
			return true;
		});
		
		{% if not metastory_id %}
		jQuery('#id_headline').slugify('#id_slug');
		{% endif %}
		
		function adjustTags() {
			$("#id_newsrooms option").each(function(){  
				csoption = $(this).val();  
				$(".inputDiv :checkbox").each(function(){  
					$("#inherited_tags").html('');
					if( $(this).attr("name") == "tag_"+csoption ){
						$(this).attr('checked', false);
						$(this).attr('disabled', false);
					}
						
				});
			});
			
			$("#id_newsrooms option:selected").each(function(){  
				csoption = $(this).val();  
				$(".inputDiv :checkbox").each(function(){  
					if( $(this).attr("name") == "tag_"+csoption ){
						$('#inherited_tags').html($('#inherited_tags').html() + '<span class="tag">' +$(this).val()+ '</span>');
						$(this).attr('checked', true);
						$(this).attr('disabled', true);
					}
				});
			});
		};
		
		$("a.zoom").fancybox({
			'overlayOpacity'	:	0.7,
			'overlayColor'		:	'#FFF',
			'zoomSpeedIn'		:	500,
			'zoomSpeedOut'		:	500,
			'overlayShow'		:	false
		});
		
		adjustTags();
	});
{% endblock %}

{% extends "admin/change_form.html" %}
{% load i18n %}

{% block coltype %}colMS{% endblock %}


{% block sidebar %}
<div id="content-related">
		<div id="navcontainer">
				<h3>Filter Stories By:</h3>
				<h4>Newsroom</h4>
				<ul id="navlist">
					{% for n in newsrooms %}
						<li><input type="checkbox" name="tags" value="{{ n.short_name }}" class="story_filters"> {{ n }}</li>
					{% endfor %}
				</ul>
				<h4>Tags</h4>
				<ul id="navlist">
						{% for t in tags %}
							<li><input type="checkbox" name="tags" value="{{ t }}" class="story_filters"> {{ t }}</li>
						{% endfor %}
				</ul>
		</div>
</div>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.js"></script>
<script type="text/javascript" charset="utf-8">
	jQuery(document).ready(function() {
		var tagsused = [];
		jQuery('.story_filters').click(function() {
			tagsused = []
			jQuery( ".story_filters:checked" ).each(function(){
		  	tagsused.push( jQuery(this).attr('value').toLowerCase() );
			});
			
			jQuery.post('/api/{{ API_VERSION }}/{{ INTERNAL_API_KEY }}/filtered_stories/', {'tags':tagsused.join()}, function(data) {
				var options = '';
				var regx = /\'/g;
				jQuery.each(data.stories, function(i,item){
					options = options+'<option value="'+item.id+'">( '+item.year+': '+item.newsrooms+' ) '+item.headline.replace(regx, "\'");+'</option>'
				});
				jQuery('select#id_stories').html(options);
			},'json');
		});
	});
</script>
{% endblock %}
